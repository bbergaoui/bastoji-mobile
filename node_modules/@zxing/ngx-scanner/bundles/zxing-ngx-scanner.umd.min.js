!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@zxing/library"),require("rxjs/BehaviorSubject"),require("@angular/core"),require("@angular/common"),require("@angular/forms")):"function"==typeof define&&define.amd?define(["exports","@zxing/library","rxjs/BehaviorSubject","@angular/core","@angular/common","@angular/forms"],t):t((e.zxing=e.zxing||{},e.zxing["ngx-scanner"]={}),e.library,e.Rx,e.ng.core,e.ng.common,e.ng.forms)}(this,function(e,a,n,t,i,o){"use strict";var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};var s=function(t){function e(e){return void 0===e&&(e=500),t.call(this,new a.QRCodeReader,e)||this}return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(e,t),e}(function(){function e(e,t){void 0===t&&(t=500),this.reader=e,this.timeBetweenScans=t,this.torchCompatible=new n.BehaviorSubject(!1)}return e.prototype.decodeFromInputVideoDevice=function(t,e,n){var i=this;e!==undefined&&(this.deviceId=e),this.reset(),this.prepareVideoElement(n);var o={audio:!1,video:this.deviceId===undefined?{facingMode:{exact:"environment"}}:{deviceId:{exact:this.deviceId}}};"undefined"!=typeof navigator&&navigator.mediaDevices.getUserMedia(o).then(function(e){return i.startDecodeFromStream(e,t)})["catch"](function(e){console.error(e)})},e.prototype.startDecodeFromStream=function(e,t){this.stream=e,this.bindVideoSrc(this.videoElement,this.stream),this.bindEvents(this.videoElement,t),this.checkTorchCompatibility(this.stream)},e.prototype.bindVideoSrc=function(e,t){try{e.srcObject=t}catch(n){e.src=window.URL.createObjectURL(t)}},e.prototype.unbindVideoSrc=function(e){try{e.srcObject=null}catch(t){e.src=""}},e.prototype.bindEvents=function(e,t){var n=this;t!==undefined&&(this.videoPlayingEventListener=function(){n.decodeWithDelay(t)}),e.addEventListener("playing",this.videoPlayingEventListener),this.videoLoadedMetadataEventListener=function(){e.play()},e.addEventListener("loadedmetadata",this.videoLoadedMetadataEventListener)},e.prototype.checkTorchCompatibility=function(e){var n=this;try{this.track=e.getVideoTracks()[0];new ImageCapture(this.track).getPhotoCapabilities().then(function(e){var t=!!e.torch||"fillLightMode"in e&&0!==e.fillLightMode.length;n.torchCompatible.next(t)})}catch(t){this.torchCompatible.next(!1)}},e.prototype.setTorch=function(e){this.torchCompatible.value&&(e?this.track.applyConstraints({advanced:[{torch:!0}]}):this.restart())},Object.defineProperty(e.prototype,"torchAvailable",{get:function(){return this.torchCompatible.asObservable()},enumerable:!0,configurable:!0}),e.prototype.prepareVideoElement=function(e){e||"undefined"==typeof document||((e=document.createElement("video")).width=200,e.height=200),this.videoElement=e},e.prototype.decodeWithDelay=function(e){this.timeoutHandler=window.setTimeout(this.decode.bind(this,e),this.timeBetweenScans)},e.prototype.decode=function(e,t,n,i){void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===i&&(i=!1),undefined===this.canvasElementContext&&this.prepareCaptureCanvas(),this.canvasElementContext.drawImage(this.videoElement||this.imageElement,0,0);var o=new a.HTMLCanvasElementLuminanceSource(this.canvasElement),r=new a.BinaryBitmap(new a.HybridBinarizer(o));try{e(this.reader.decode(r)),!i&&this.stream&&this.decodeWithDelay(e)}catch(s){t&&a.Exception.isOfType(s,a.Exception.NotFoundException)?this.decodeWithDelay(e):n&&(a.Exception.isOfType(s,a.Exception.ChecksumException)||a.Exception.isOfType(s,a.Exception.FormatException))&&(console.warn("zxing-scanner","Checksum or format error, trying again...",s),this.decodeWithDelay(e))}},e.prototype.prepareCaptureCanvas=function(){if("undefined"==typeof document)return this.canvasElement=undefined,void(this.canvasElementContext=undefined);var e,t,n=document.createElement("canvas");this.videoElement!==undefined?(e=this.videoElement.videoWidth,t=this.videoElement.videoHeight):(e=this.imageElement.naturalWidth||this.imageElement.width,t=this.imageElement.naturalHeight||this.imageElement.height),n.style.width=e+"px",n.style.height=t+"px",n.width=e,n.height=t,this.canvasElement=n,this.canvasElementContext=n.getContext("2d")},e.prototype.stop=function(){this.timeoutHandler&&(window.clearTimeout(this.timeoutHandler),this.timeoutHandler=null),this.stream&&(this.stream.getTracks()[0].stop(),this.stream=null)},e.prototype.reset=function(){if(this.stop(),this.videoElement){if(undefined!==this.videoPlayEndedEventListener&&this.videoElement.removeEventListener("ended",this.videoPlayEndedEventListener),undefined!==this.videoPlayingEventListener&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),undefined!==this.videoLoadedMetadataEventListener&&this.videoElement.removeEventListener("loadedmetadata",this.videoLoadedMetadataEventListener),this.stream)try{this.stream.getVideoTracks().forEach(function(e){e.stop()})}catch(e){}this.unbindVideoSrc(this.videoElement),this.videoElement.removeAttribute("src"),this.videoElement=undefined}this.imageElement&&(undefined!==this.videoPlayEndedEventListener&&this.imageElement.removeEventListener("load",this.imageLoadedEventListener),this.imageElement.src=undefined,this.imageElement.removeAttribute("src"),this.imageElement=undefined),this.canvasElementContext=undefined,this.canvasElement=undefined},e.prototype.restart=function(){this.decodeFromInputVideoDevice(undefined,undefined,this.videoElement)},e}()),c=function(){function e(){this.scanThrottling=1500,this.scannerEnabled=!0,this.autofocusEnabled=!0,this.torchCompatible=new t.EventEmitter,this.scanSuccess=new t.EventEmitter,this.scanFailure=new t.EventEmitter,this.scanError=new t.EventEmitter,this.scanComplete=new t.EventEmitter,this.camerasFound=new t.EventEmitter,this.camerasNotFound=new t.EventEmitter,this.permissionResponse=new t.EventEmitter,this.codeReader=new s(1500),this.hasNavigator="undefined"!=typeof navigator,this.isMediaDevicesSuported=this.hasNavigator&&!!navigator.mediaDevices,this.isEnumerateDevicesSuported=!(!this.isMediaDevicesSuported||!navigator.mediaDevices.enumerateDevices)}return Object.defineProperty(e.prototype,"torch",{set:function(e){this.codeReader.setTorch(e)},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){e.scannerEnabled&&(this.scannerEnabled?this.videoInputDevice&&this.scan(this.videoInputDevice.deviceId):this.resetScan()),e.device&&(this.device?this.changeDevice(this.device):(console.warn("zxing-scanner","device","Unselected device."),this.resetScan())),e.scanThrottling&&this.setCodeReaderThrottling(this.scanThrottling)},e.prototype.ngAfterViewInit=function(){var t=this;this.previewElemRef?(this.previewElemRef.nativeElement.setAttribute("autoplay",!1),this.previewElemRef.nativeElement.setAttribute("muted",!0),this.previewElemRef.nativeElement.setAttribute("playsinline",!0),this.previewElemRef.nativeElement.setAttribute("autofocus",this.autofocusEnabled),this.askForPermission().subscribe(function(e){e?(t.enumarateVideoDevices(function(e){e&&0<e.length?t.camerasFound.next(e):t.camerasNotFound.next()}),t.startScan(t.videoInputDevice),t.codeReader.torchAvailable.subscribe(function(e){t.torchCompatible.emit(e)})):!1===e?console.warn("zxing-scanner","ngAfterViewInit","User has denied permission."):console.warn("zxing-scanner","ngAfterViewInit","It was not possible to check for permissions.")})):console.warn("zxing-scanner","Preview element not found!")},e.prototype.ngOnDestroy=function(){this.resetScan()},e.prototype.setCodeReaderThrottling=function(e){this.codeReader=new s(e),this.restartScan()},e.prototype.changeDevice=function(e){this.videoInputDevice=e,this.startScan(e)},e.prototype.changeDeviceById=function(e){this.changeDevice(this.getDeviceById(e))},e.prototype.getDeviceById=function(t){return this.videoInputDevices.find(function(e){return e.deviceId===t})},e.prototype.setPermission=function(e){return this.hasPermission=e,this.permissionResponse.next(e),this.permissionResponse},e.prototype.askForPermission=function(){var n=this;return this.hasNavigator?this.isMediaDevicesSuported?(navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then(function(e){try{n.codeReader.bindVideoSrc(n.previewElemRef.nativeElement,e),e.getVideoTracks().forEach(function(e){e.stop()}),n.codeReader.unbindVideoSrc(n.previewElemRef.nativeElement),n.setPermission(!0)}catch(t){console.error("zxing-scanner","askForPermission",t),n.setPermission(undefined)}})["catch"](function(e){switch(console.warn("zxing-scanner","askForPermission",e),e.name){case"NotAllowedError":n.setPermission(!1);break;case"NotFoundError":n.camerasNotFound.next(e);break;default:n.setPermission(undefined)}}),this.permissionResponse):(console.error("zxing-scanner","askForPermission","Can't get user media, this is not supported."),this.setPermission(undefined)):(console.error("zxing-scanner","askForPermission","Can't ask permission, navigator is not present."),this.setPermission(undefined))},e.prototype.scan=function(e){var t=this;try{this.codeReader.decodeFromInputVideoDevice(function(e){e?t.dispatchScanSuccess(e):t.dispatchScanFailure(),t.dispatchScanComplete(e)},e,this.previewElemRef.nativeElement)}catch(n){this.dispatchScanError(n),this.dispatchScanComplete(undefined)}},e.prototype.startScan=function(e){this.scannerEnabled&&e&&this.scan(e.deviceId)},e.prototype.resetScan=function(){this.codeReader.reset()},e.prototype.restartScan=function(){this.restartScan(),this.startScan(this.device)},e.prototype.dispatchScanSuccess=function(e){this.scanSuccess.next(e.getText())},e.prototype.dispatchScanFailure=function(){this.scanFailure.next()},e.prototype.dispatchScanError=function(e){this.scanError.next(e)},e.prototype.dispatchScanComplete=function(e){this.scanComplete.next(e)},e.prototype.enumarateVideoDevices=function(d){var u=this;this.hasNavigator?this.isEnumerateDevicesSuported?navigator.mediaDevices.enumerateDevices().then(function(e){u.videoInputDevices=[];try{for(var t=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}(e),n=t.next();!n.done;n=t.next()){var i=n.value,o={};for(var r in i)o[r]=i[r];"video"===o.kind&&(o.kind="videoinput"),o.deviceId||(o.deviceId=o.id),o.label||(o.label="Camera (no-permission)"),"videoinput"===o.kind&&u.videoInputDevices.push(o)}}catch(c){s={error:c}}finally{try{n&&!n.done&&(a=t["return"])&&a.call(t)}finally{if(s)throw s.error}}var s,a;d(u.videoInputDevices)}):console.error("zxing-scanner","enumarateVideoDevices","Can't enumerate devices, method not supported."):console.error("zxing-scanner","enumarateVideoDevices","Can't enumerate devices, navigator is not present.")},e}();c.decorators=[{type:t.Component,args:[{selector:"zxing-scanner",template:'<video [ngClass]="cssClass" #preview>\n    <p>\n        Your browser does not support this feature, please try to upgrade it.\n    </p>\n    <p>\n        Seu navegador não suporta este recurso, por favor tente atualizá-lo.\n    </p>\n</video>\n',styles:[":host{display:block}video{width:100%;height:auto;-o-object-fit:contain;object-fit:contain}"],changeDetection:t.ChangeDetectionStrategy.OnPush}]}],c.ctorParameters=function(){return[]},c.propDecorators={previewElemRef:[{type:t.ViewChild,args:["preview"]}],scanThrottling:[{type:t.Input}],scannerEnabled:[{type:t.Input}],device:[{type:t.Input}],cssClass:[{type:t.Input}],autofocusEnabled:[{type:t.Input}],torch:[{type:t.Input}],torchCompatible:[{type:t.Output}],scanSuccess:[{type:t.Output}],scanFailure:[{type:t.Output}],scanError:[{type:t.Output}],scanComplete:[{type:t.Output}],camerasFound:[{type:t.Output}],camerasNotFound:[{type:t.Output}],permissionResponse:[{type:t.Output}]};var d=function(){function e(){}return e.forRoot=function(){return{ngModule:e}},e}();d.decorators=[{type:t.NgModule,args:[{imports:[i.CommonModule,o.FormsModule],declarations:[c],exports:[c]}]}],d.ctorParameters=function(){return[]},e.ZXingScannerModule=d,e.ɵa=c,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=zxing-ngx-scanner.umd.min.js.map
